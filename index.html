<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fund Tron Contract</title>
    <script src="https://cdn.jsdelivr.net/npm/tronweb/dist/TronWeb.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
        }
        button:disabled {
            background-color: #ccc;
        }
        .connected-address {
            margin-top: 20px;
            font-size: 18px;
            color: #28a745;
        }
        .not-connected {
            font-size: 18px;
            color: #dc3545;
        }
    </style>
</head>
<body>

    <h1>Connect to TronLink Wallet</h1>

    <button id="connectButton">Connect Wallet</button>

    <div id="walletStatus" class="not-connected">
        Please connect your TronLink wallet to continue.
    </div>

    <h2>Fund Tron Contract with TRX</h2>
    <button id="fundContract" disabled>Fund Contract with TRX</button>

    <script>
        let tronWeb;
        let connectedAddress = null;

        // Button and status elements
        const connectButton = document.getElementById('connectButton');
        const fundContractButton = document.getElementById('fundContract');
        const walletStatus = document.getElementById('walletStatus');

        // Contract address (replace with your contract's address)
        const contractAddress = "TXYZ..."; // Example contract address

        // Detect TronLink
        async function detectTronLink() {
            if (window.tronLink && window.tronLink.ready) {
                tronWeb = window.tronLink;
                await checkConnection();
            } else {
                walletStatus.innerText = "TronLink is not installed. Please install TronLink extension.";
                walletStatus.classList.add("not-connected");
                walletStatus.classList.remove("connected");
            }
        }

        // Check if TronLink is connected to the site
        async function checkConnection() {
            if (!tronWeb || !tronWeb.defaultAddress.base58) {
                walletStatus.innerText = "Please connect your TronLink wallet.";
                walletStatus.classList.add("not-connected");
                walletStatus.classList.remove("connected");
                return;
            }

            connectedAddress = tronWeb.defaultAddress.base58;
            walletStatus.innerText = `Connected: ${connectedAddress}`;
            walletStatus.classList.add("connected");
            walletStatus.classList.remove("not-connected");

            // Enable the Fund Contract button after successful connection
            fundContractButton.disabled = false;
        }

        // Connect TronLink wallet
        async function connectWallet() {
            if (!tronWeb) {
                alert("TronLink is not installed or not available.");
                return;
            }

            try {
                // Request account access
                await tronWeb.request({ method: 'tron_requestAccounts' });

                // Check connection again
                await checkConnection();
            } catch (err) {
                console.error('Error connecting to TronLink:', err);
                alert('Failed to connect to TronLink. Please ensure the TronLink extension is installed and try again.');
            }
        }

        // Function to fund the contract with TRX
        async function fundContract() {
            if (!connectedAddress) {
                alert('Please connect your wallet first.');
                return;
            }

            try {
                const sender = connectedAddress;

                // Amount to fund the contract (in sun, 1 TRX = 1,000,000 sun)
                const amountInTRX = 1;  // Amount in TRX
                const amountInSun = tronWeb.toSun(amountInTRX);  // Convert TRX to Sun (1 TRX = 1,000,000 sun)

                // Send TRX from sender to contract
                const transaction = await tronWeb.trx.sendTransaction(contractAddress, amountInSun, sender);

                if (transaction.result) {
                    console.log(`Successfully funded contract with ${amountInTRX} TRX`);
                    alert(`Successfully funded contract with ${amountInTRX} TRX`);
                } else {
                    console.error('Transaction failed:', transaction);
                    alert('Transaction failed. Please try again.');
                }
            } catch (err) {
                console.error('Error funding contract:', err);
                alert('Error funding contract.');
            }
        }

        // Event Listeners
        connectButton.onclick = connectWallet;
        fundContractButton.onclick = fundContract;

        // Run detectTronLink when the page loads
        detectTronLink();

    </script>
</body>
</html>
